<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¬Ø±Ø¯ Ø§Ù„Ù…Ø­Ù„ Ø§Ù„Ø°ÙƒÙŠ 2025 - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø³ØªÙ‚Ù„Ø©</title>
    <style>
        /* ØªØµÙ…ÙŠÙ… Ø¹ØµØ±ÙŠ Ù„Ù…Ø­Ù„Ùƒ */
        body { font-family: 'Segoe UI', sans-serif; background: #0f172a; color: #f8fafc; text-align: center; margin: 0; padding: 10px; }
        .jard-grid { display: grid; grid-template-columns: 1fr 350px; gap: 20px; max-width: 1000px; margin: auto; }
        #video-container { position: relative; background: #000; border-radius: 20px; overflow: hidden; border: 3px solid #3b82f6; }
        video { width: 100%; display: block; }
        .control-panel { background: #1e293b; padding: 20px; border-radius: 20px; border: 1px solid #334155; }
        .inventory-list { background: #020617; border-radius: 12px; margin-top: 15px; padding: 15px; height: 350px; overflow-y: auto; text-align: right; border: 1px solid #334155; }
        .item-card { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #1e293b; color: #10b981; font-weight: bold; }
        .status-tag { display: inline-block; padding: 5px 15px; border-radius: 50px; background: #334155; color: #fbbf24; font-size: 13px; margin-bottom: 15px; }
        input { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 8px; border: 1px solid #3b82f6; background: #0f172a; color: white; }
    </style>
</head>
<body>

    <h2 style="color: #3b82f6;">ğŸ›’ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø±Ø¯ Ø§Ù„Ø³Ø±ÙŠØ¹ (Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…Ø³ØªÙ‚Ù„ 2025)</h2>
    <div id="status" class="status-tag">Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ù…Ø­Ù„ÙŠØ§Ù‹ Ø¨Ù†Ø³Ø¨Ø© 100% (ÙˆØ¯Ø§Ø¹Ø§Ù‹ Ù„Ù„Ù€ 404)</div>

    <div class="jard-grid">
        <div id="video-container">
            <video id="webcam" autoplay playsinline muted></video>
            <!-- ÙÙ„Ø§Ø´ Ø¨ØµØ±ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø±ØµØ¯ -->
            <div id="flash" style="position:absolute; top:0; left:0; width:100%; height:100%; background:white; opacity:0; pointer-events:none;"></div>
        </div>

        <div class="control-panel">
            <h4>Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØµÙ†Ù Ø§Ù„Ø­Ø§Ù„ÙŠ:</h4>
            <input type="text" id="current-item-name" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù (Ù…Ø«Ù„Ø§Ù‹: Ø£Ø±Ø²)">
            <p style="font-size: 11px; color: #94a3b8;">* Ø¨Ù…Ø¬Ø±Ø¯ ØªÙ…Ø±ÙŠØ± Ø£ÙŠ Ø´ÙŠØ¡ Ø£Ù…Ø§Ù… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø³ÙŠØªÙ… Ø±ØµØ¯Ù‡ ØªØ­Øª Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù….</p>
            
            <div id="inventory-list" class="inventory-list">
                <b>Ø³Ø¬Ù„ Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ù…Ø¬Ø±ÙˆØ¯Ø©:</b>
            </div>
            
            <button onclick="downloadReport()" style="margin-top: 15px; width: 100%; padding: 12px; background: #10b981; border: none; color: white; border-radius: 8px; cursor: pointer; font-weight: bold;">ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</button>
        </div>
    </div>

    <script>
        // Ø§Ù„ÙƒÙˆØ¯ ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø¬Ø§ÙØ§ Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„ØµØ§ÙÙŠØ© Ù„ØªØ¬Ù†Ø¨ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø£ÙŠ Ø³ÙŠØ±ÙØ±Ø§Øª Ø®Ø§Ø±Ø¬ÙŠØ© Ù…Ø­Ø¸ÙˆØ±Ø©
        const video = document.getElementById('webcam');
        const itemNameInput = document.getElementById('current-item-name');
        const list = document.getElementById('inventory-list');
        const flash = document.getElementById('flash');
        
        let inventory = {}; // { "Ø§Ù„Ø§Ø³Ù…": Ø§Ù„Ø¹Ø¯Ø¯ }
        let isProcessing = false;
        let lastFrame;

        // 1. ÙØªØ­ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙÙˆØ±Ø§Ù‹ ÙˆØ¨Ø¯ÙˆÙ† Ù…ÙƒØªØ¨Ø§Øª Ø®Ø§Ø±Ø¬ÙŠØ©
        async function initCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: "environment" } 
                });
                video.srcObject = stream;
                // Ø§Ù„Ø¨Ø¯Ø¡ ÙÙŠ Ø±ØµØ¯ "Ø§Ù„ØªÙ…Ø±ÙŠØ±" ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                setInterval(detectMotion, 100); 
            } catch (err) {
                alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø·Ø§Ø¡ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù„Ù„Ø§Ø¨ØªÙˆØ¨");
            }
        }

        // 2. ØªÙ‚Ù†ÙŠØ© "Ø±ØµØ¯ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ" (Motion Detection)
        // ØªØ¹Ù…Ù„ Ù‡Ø°Ù‡ Ø§Ù„ØªÙ‚Ù†ÙŠØ© ÙƒØ¨Ø¯ÙŠÙ„ Ø°ÙƒÙŠ ÙˆØ³Ø±ÙŠØ¹ Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ù…Ø­Ø¸ÙˆØ± ÙÙŠ Ø´Ø¨ÙƒØªÙƒ
        function detectMotion() {
            if (isProcessing || itemNameInput.value === "") return;

            const canvas = document.createElement('canvas');
            canvas.width = 48; canvas.height = 36;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            const currentFrame = ctx.getImageData(0, 0, canvas.width, canvas.height).data;

            if (lastFrame) {
                let diff = 0;
                for (let i = 0; i < currentFrame.length; i += 4) {
                    diff += Math.abs(currentFrame[i] - lastFrame[i]);
                }
                
                // Ø¥Ø°Ø§ ØªÙ… Ø±ØµØ¯ ØªÙ…Ø±ÙŠØ± Ù…Ù†ØªØ¬ (ØªØºÙŠØ± ÙÙŠ Ø§Ù„ØµÙˆØ±Ø©)
                if (diff > 15000) { 
                    handleCount(itemNameInput.value);
                }
            }
            lastFrame = currentFrame;
        }

        function handleCount(name) {
            isProcessing = true;
            
            // ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
            if (!inventory[name]) inventory[name] = 0;
            inventory[name]++;
            
            playBeep();
            showFlash();
            updateUI();

            // Ù…Ù†Ø¹ Ø§Ù„Ø¹Ø¯ Ø§Ù„Ù…ØªÙƒØ±Ø± Ù„Ù„Ù‚Ø·Ø¹Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø© (Ø§Ù†ØªØ¸Ø§Ø± Ø«Ø§Ù†ÙŠØªÙŠÙ† Ù‚Ø¨Ù„ Ø§Ù„Ù‚Ø·Ø¹Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©)
            setTimeout(() => { isProcessing = false; }, 2000);
        }

        function updateUI() {
            list.innerHTML = "<b>Ø³Ø¬Ù„ Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ù…Ø¬Ø±ÙˆØ¯Ø©:</b>";
            for (let name in inventory) {
                const row = document.createElement('div');
                row.className = 'item-card';
                row.innerHTML = `<span>${name}</span> <span>Ø§Ù„Ø¹Ø¯Ø¯: ${inventory[name]}</span>`;
                list.prepend(row);
            }
        }

        function playBeep() {
            const context = new (window.AudioContext || window.webkitAudioContext)();
            const osc = context.createOscillator();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(1000, context.currentTime);
            osc.connect(context.destination);
            osc.start();
            osc.stop(context.currentTime + 0.1);
        }

        function showFlash() {
            flash.style.opacity = "0.6";
            setTimeout(() => { flash.style.opacity = "0"; }, 100);
        }

        function downloadReport() {
            let csv = "Ø§Ù„ØµÙ†Ù,Ø§Ù„ÙƒÙ…ÙŠØ©\n";
            for(let name in inventory) csv += `${name},${inventory[name]}\n`;
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = 'jard_report_2025.csv'; a.click();
        }

        initCamera();
    </script>
</body>
</html>
