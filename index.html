<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¬Ø±Ø¯ Ø§Ù„Ù…Ø­Ù„ 2025</title>
    
    <!-- Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±ÙˆØ§Ø¨Ø· Ø¬ÙˆØ¬Ù„ Ø§Ù„Ø±Ø³Ù…ÙŠØ© Ù…Ø¨Ø§Ø´Ø±Ø© (Ù†Ø§Ø¯Ø±Ù‹Ø§ Ù…Ø§ ØªÙØ­Ø¸Ø±) -->
    <script src="cdn.jsdelivr.net"></script>
    <script src="cdn.jsdelivr.net"></script>

    <style>
        body { font-family: sans-serif; background: #000; color: #fff; text-align: center; margin: 0; padding: 20px; }
        .main-box { max-width: 500px; margin: auto; background: #1a1a1a; padding: 20px; border-radius: 20px; border: 2px solid #333; }
        #video-container { position: relative; width: 100%; border-radius: 10px; overflow: hidden; background: #000; }
        video { width: 100%; display: block; }
        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        #loading-msg { color: #ffeb3b; margin: 15px 0; font-size: 14px; }
        button { background: #28a745; color: white; border: none; padding: 15px; border-radius: 10px; width: 100%; font-size: 18px; cursor: pointer; display: none; }
    </style>
</head>
<body>

    <div class="main-box">
        <h3>ğŸ›’ Ø£Ø¯Ø§Ø© Ø¬Ø±Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ©</h3>
        
        <div id="video-container">
            <video id="webcam" autoplay playsinline muted></video>
            <canvas id="overlay"></canvas>
        </div>

        <div id="loading-msg">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø³ÙŠØ±ÙØ±Ø§Øª Ø¬ÙˆØ¬Ù„ Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ...</div>
        <button id="start-btn">Ø¨Ø¯Ø¡ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆØ§Ù„Ø¬Ø±Ø¯</button>
    </div>

    <script>
        const video = document.getElementById('webcam');
        const canvas = document.getElementById('overlay');
        const msg = document.getElementById('loading-msg');
        const btn = document.getElementById('start-btn');
        const ctx = canvas.getContext('2d');
        let model;

        // 1. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù…Ù† Ø¬ÙˆØ¬Ù„
        async function loadModel() {
            try {
                msg.innerText = "Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ (Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ù„Ø­Ø¸Ø§Øª)...";
                model = await cocoSsd.load();
                msg.innerText = "âœ… Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² ØªÙ…Ø§Ù…Ø§Ù‹!";
                msg.style.color = "#4caf50";
                btn.style.display = "block";
            } catch (err) {
                msg.innerText = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©! Ø¬Ø±Ø¨ ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ù† (Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‡Ø§ØªÙ) ÙˆÙ„ÙŠØ³ Ø§Ù„ÙˆØ§ÙŠ ÙØ§ÙŠ.";
                msg.style.color = "#f44336";
            }
        }

        // 2. ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
        btn.onclick = async () => {
            const stream = await navigator.mediaDevices.getUserMedia({
                video: { facingMode: "environment" }
            });
            video.srcObject = stream;
            btn.style.display = "none";
            msg.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø³Ø­ Ø§Ù„Ø¨ØµØ±ÙŠ Ù„Ù„Ø±ÙÙˆÙ...";
            predict();
        };

        // 3. Ø§Ù„ØªÙ†Ø¨Ø¤ ÙˆØ§Ù„Ø±Ø³Ù…
        async function predict() {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;

            const predictions = await model.detect(video);
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            predictions.forEach(p => {
                const [x, y, width, height] = p.bbox;
                ctx.strokeStyle = "#00ff00";
                ctx.lineWidth = 4;
                ctx.strokeRect(x, y, width, height);

                ctx.fillStyle = "#00ff00";
                ctx.font = "bold 18px Arial";
                ctx.fillText(p.class + " " + Math.round(p.score * 100) + "%", x, y > 20 ? y - 10 : 20);
            });

            requestAnimationFrame(predict);
        }

        loadModel();
    </script>
</body>
</html>
