<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø±Ø¯ Ø§Ù„Ø°ÙƒÙŠ - Ù†Ø³Ø®Ø© Ø§Ù„Ù„Ø§Ø¨ØªÙˆØ¨ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</title>
    
    <!-- Ø±ÙˆØ§Ø¨Ø· ÙƒØ§Ù…Ù„Ø© ÙˆÙ…Ø­Ù…ÙŠØ© Ø¨Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ ØµØ±ÙŠØ­ Ù„Ù…Ù†Ø¹ Ø§Ù„Ù…ØªØµÙØ­ Ù…Ù† ØªÙˆØ¬ÙŠÙ‡Ù‡Ø§ Ù„Ù…Ø¬Ù„Ø¯Ø§ØªÙƒ -->
    <script src="cdnjs.cloudflare.com" crossorigin="anonymous"></script>
    <script src="unpkg.com" crossorigin="anonymous"></script>

    <style>
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: #0f172a; color: #f8fafc; text-align: center; margin: 0; padding: 20px; }
        .main-card { max-width: 600px; margin: auto; background: #1e293b; padding: 25px; border-radius: 24px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); border: 1px solid #334155; }
        #camera-area { position: relative; width: 100%; border-radius: 16px; overflow: hidden; background: #000; border: 2px solid #3b82f6; line-height: 0; }
        canvas { width: 100% !important; height: auto !important; }
        #status-pill { display: inline-block; margin-top: 20px; padding: 8px 20px; border-radius: 50px; background: #334155; color: #fbbf24; font-weight: 600; font-size: 14px; transition: all 0.5s; }
        .log-panel { margin-top: 20px; background: #020617; border-radius: 12px; padding: 15px; height: 120px; overflow-y: auto; text-align: right; border: 1px solid #1e293b; font-family: 'Courier New', monospace; }
        .log-entry { border-bottom: 1px solid #1e293b; padding: 5px 0; color: #10b981; font-size: 13px; }
    </style>
</head>
<body>

    <div class="main-card">
        <h2 style="margin-top: 0; color: #3b82f6;">ğŸ›’ Ø¬Ø±Ø¯ Ø§Ù„Ù…Ø­Ù„ (Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ)</h2>
        <p style="color: #94a3b8; font-size: 14px;">Ù†Ø³Ø®Ø© Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù„Ø§Ø¨ØªÙˆØ¨ - Ø±ØµØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠ</p>

        <div id="camera-area">
            <!-- Ø³ØªØ¸Ù‡Ø± Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù‡Ù†Ø§ -->
        </div>

        <div id="status-pill">Ø¬Ø§Ø±ÙŠ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¹Ù‚Ù„ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ...</div>

        <div class="log-panel" id="log">
            <div style="color: #64748b;">Ø§Ù†ØªØ¸Ø§Ø± Ø±ØµØ¯ Ø§Ù„Ø£ØµÙ†Ø§Ù...</div>
        </div>
    </div>

    <script>
        let video;
        let detector;
        let detections = [];
        let isModelReady = false;

        // Ø¯Ø§Ù„Ø© Ø³Ø­Ø±ÙŠØ© Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª ØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡Ø§ ÙØ¹Ù„Ø§Ù‹
        window.onerror = function(msg, url) {
            if (url.includes('cdnjs') || url.includes('unpkg')) {
                document.getElementById('status-pill').innerText = "âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª! Ø¬Ø±Ø¨ Ù…ØªØµÙØ­Ø§Ù‹ Ø¢Ø®Ø±";
                document.getElementById('status-pill').style.background = "#ef4444";
                document.getElementById('status-pill').style.color = "#fff";
            }
        };

        function setup() {
            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø±Ø³Ù… Ù„Ù„Ø§Ø¨ØªÙˆØ¨
            const canvas = createCanvas(480, 360);
            canvas.parent('camera-area');

            // ÙØªØ­ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ (Ø§Ù„ÙˆÙŠØ¨ ÙƒØ§Ù…)
            video = createCapture(VIDEO);
            video.size(480, 360);
            video.hide();

            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ COCO-SSD
            // Ù†Ø³ØªØ®Ø¯Ù… Ø±Ø§Ø¨Ø·Ø§Ù‹ Ø¯Ø§Ø®Ù„ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ù…ÙƒØªØ¨Ø© Ù„ØªÙ‚Ù„ÙŠÙ„ Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª
            detector = ml5.objectDetector('cocossd', () => {
                isModelReady = true;
                const pill = document.getElementById('status-pill');
                pill.innerText = "âœ… Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø²! Ø¶Ø¹ Ø§Ù„Ø²Ø¬Ø§Ø¬Ø© Ø£Ù…Ø§Ù… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§";
                pill.style.background = "#064e3b";
                pill.style.color = "#34d399";
                
                // Ø¨Ø¯Ø¡ Ø§Ù„Ø±ØµØ¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
                performDetection();
            });
        }

        function performDetection() {
            if (isModelReady) {
                detector.detect(video, (err, results) => {
                    if (!err) {
                        detections = results;
                        if (detections.length > 0) {
                            updateInventory(detections[0].label);
                        }
                    }
                    performDetection(); // Ø­Ù„Ù‚Ø© Ù„Ø§ Ù†Ù‡Ø§Ø¦ÙŠØ© Ù„Ù„Ø±ØµØ¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
                });
            }
        }

        function updateInventory(label) {
            const logPanel = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            
            // ØªØ±Ø¬Ù…Ø© Ø¨Ø³ÙŠØ·Ø© Ù„Ù„Ù†ØªØ§Ø¦Ø¬
            let arName = label;
            if (label === 'bottle') arName = "Ø²Ø¬Ø§Ø¬Ø© Ù…ÙŠØ§Ù‡";
            if (label === 'cell phone') arName = "Ù‡Ø§ØªÙ Ù…Ø­Ù…ÙˆÙ„";
            if (label === 'person') arName = "Ø´Ø®Øµ (Ø£Ù†Øª)";

            // Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ø¬Ù„ Ø¨Ø¯ÙˆÙ† ØªÙƒØ±Ø§Ø± Ù…Ù…Ù„
            const lastEntry = logPanel.firstChild.innerText || "";
            if (!lastEntry.includes(arName)) {
                const div = document.createElement('div');
                div.className = 'log-entry';
                div.innerText = `[${time}] Ø±ØµØ¯: ${arName}`;
                logPanel.prepend(div);
            }
        }

        function draw() {
            // Ø±Ø³Ù… Ù…Ø§ ØªØ±Ø§Ù‡ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
            image(video, 0, 0, width, height);

            // Ø±Ø³Ù… Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª Ø­ÙˆÙ„ Ø§Ù„Ø£Ø¬Ø³Ø§Ù…
            for (let i = 0; i < detections.length; i++) {
                let obj = detections[i];
                stroke(59, 130, 246); // Ù„ÙˆÙ† Ø£Ø²Ø±Ù‚ Ø¹ØµØ±ÙŠ
                strokeWeight(4);
                noFill();
                rect(obj.x, obj.y, obj.width, obj.height, 8);
                
                noStroke();
                fill(59, 130, 246);
                rect(obj.x, obj.y - 30, textWidth(obj.label) + 20, 30, 4);
                fill(255);
                textSize(16);
                text(obj.label, obj.x + 10, obj.y - 8);
            }
        }
    </script>
</body>
</html>
