<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø±Ø¯ Ø§Ù„Ø°ÙƒÙŠ - Ù†Ø³Ø®Ø© Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</title>
    
    <!-- Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø¨Ø±Ø§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø± ÙˆÙ‚ÙˆÙŠ Ø¬Ø¯Ø§Ù‹ -->
    <script src="cdn.jsdelivr.net"></script>

    <style>
        body { font-family: sans-serif; background: #000; color: #fff; text-align: center; margin: 0; padding: 10px; }
        #container { max-width: 500px; margin: auto; border: 2px solid #333; border-radius: 20px; padding: 15px; background: #111; }
        #v-area { position: relative; width: 100%; border-radius: 15px; overflow: hidden; background: #222; }
        video { width: 100%; display: block; }
        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        button { background: #28a745; color: white; border: none; padding: 18px; font-size: 18px; border-radius: 12px; cursor: pointer; width: 100%; margin-top: 15px; font-weight: bold; }
        button:disabled { background: #444; color: #888; }
        #status { margin-top: 15px; font-size: 13px; color: #aaa; border-top: 1px solid #333; padding-top: 10px; }
    </style>
</head>
<body>

    <div id="container">
        <h2>Ø£Ø¯Ø§Ø© Ø¬Ø±Ø¯ Ø§Ù„Ù…Ø­Ù„ ğŸ›’</h2>
        <div id="v-area">
            <video id="web" autoplay playsinline></video>
            <canvas id="out"></canvas>
        </div>
        <button id="btn" disabled>Ø¬Ø§Ø±ÙŠ ØªØ­Ø¶ÙŠØ± Ø§Ù„Ù…Ø­Ø±Ùƒ...</button>
        <div id="status">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø³ÙŠØ±ÙØ±Ø§Øª Ø¬ÙˆØ¬Ù„...</div>
    </div>

    <script>
        const video = document.getElementById('web');
        const canvas = document.getElementById('out');
        const btn = document.getElementById('btn');
        const status = document.getElementById('status');
        const ctx = canvas.getContext('2d');
        let objectDetector;

        // Ø¯Ø§Ù„Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…ÙƒØªØ¨Ø© ÙˆÙ…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¯ÙŠÙ„Ø© Ø¥Ø°Ø§ ÙÙÙ‚Ø¯Øª
        async function setupAI() {
            try {
                // ÙØ­Øµ ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…ÙƒØªØ¨Ø© (window.tasksVision)
                if (typeof tasksVision === 'undefined') {
                    status.innerText = "ÙØ´Ù„ Ø§Ù„Ù…ØµØ¯Ø± Ø§Ù„Ø£ÙˆÙ„.. Ø¬Ø§Ø±ÙŠ ØªØ¬Ø±Ø¨Ø© Ù…ØµØ¯Ø± Ø¨Ø¯ÙŠÙ„...";
                    await loadScript("www.gstatic.com");
                }

                const vision = window.tasksVision;
                const wasmFiles = "cdn.jsdelivr.net";
                
                const filesetResolver = await vision.FilesetResolver.forVisionTasks(wasmFiles);
                
                objectDetector = await vision.ObjectDetector.createFromOptions(filesetResolver, {
                    baseOptions: {
                        modelAssetPath: "storage.googleapis.com",
                        delegate: "GPU"
                    },
                    scoreThreshold: 0.5,
                    runningMode: "VIDEO"
                });

                status.innerText = "ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø¬Ø§Ø­! Ø§Ù„Ù…Ø­Ø±Ùƒ Ø¬Ø§Ù‡Ø².";
                status.style.color = "#4caf50";
                btn.disabled = false;
                btn.innerText = "Ø¥ÙØªØ­ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆØ§Ø¨Ø¯Ø£ Ø§Ù„Ø¬Ø±Ø¯";

            } catch (err) {
                status.innerText = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©: " + err.message;
                status.style.color = "#ff4444";
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙƒØ±Ø¨Øª ÙŠØ¯ÙˆÙŠØ§Ù‹ ÙÙŠ Ø­Ø§Ù„ ÙØ´Ù„ Ø§Ù„Ù€ HTML
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const s = document.createElement('script');
                s.src = src;
                s.onload = resolve;
                s.onerror = reject;
                document.head.appendChild(s);
            });
        }

        btn.onclick = async () => {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
                video.srcObject = stream;
                video.onloadeddata = () => {
                    btn.style.display = "none";
                    detect();
                };
            } catch (e) {
                status.innerText = "Ø®Ø·Ø£: Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù…Ø­Ø¬ÙˆØ¨Ø©!";
            }
        };

        async function detect() {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const results = await objectDetector.detectForVideo(video, Date.now());
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            results.detections.forEach(d => {
                const { originX, originY, width, height } = d.boundingBox;
                ctx.strokeStyle = "#00ff00"; ctx.lineWidth = 4;
                ctx.strokeRect(originX, originY, width, height);
                ctx.fillStyle = "#00ff00"; ctx.font = "bold 20px Arial";
                ctx.fillText(d.categories[0].categoryName, originX, originY - 10);
            });
            requestAnimationFrame(detect);
        }

        window.onload = setupAI;
    </script>
</body>
</html>
