<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø±Ø¯ Ø§Ù„Ø°ÙƒÙŠ - Ø§Ù„ØªØ¹Ø±Ù Ø§Ù„Ø¨ØµØ±ÙŠ 2025</title>
    
    <!-- Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© -->
    <script src="cdn.jsdelivr.net"></script>
    <script src="cdn.jsdelivr.net"></script>
    <script src="cdn.jsdelivr.net"></script>

    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0f172a; color: white; text-align: center; margin: 0; padding: 10px; }
        .app-container { max-width: 800px; margin: auto; display: grid; grid-template-columns: 1fr 300px; gap: 20px; }
        #video-box { position: relative; background: #000; border-radius: 15px; overflow: hidden; border: 3px solid #3b82f6; }
        video { width: 100%; height: auto; }
        .controls { background: #1e293b; padding: 20px; border-radius: 15px; border: 1px solid #334155; }
        input { width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 5px; border: none; }
        button { width: 100%; padding: 12px; margin-bottom: 5px; cursor: pointer; border-radius: 8px; border: none; font-weight: bold; }
        .train-btn { background: #f59e0b; color: white; }
        .inventory-list { background: #020617; padding: 15px; border-radius: 15px; text-align: right; height: 300px; overflow-y: auto; }
        .item-row { display: flex; justify-content: space-between; border-bottom: 1px solid #1e293b; padding: 10px 0; color: #10b981; }
        #status-bar { grid-column: span 2; background: #334155; padding: 10px; border-radius: 10px; color: #fbbf24; margin-bottom: 10px; }
    </style>
</head>
<body>

    <h2>ğŸš€ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø±Ø¯ Ø¨Ø§Ù„ØªØ¹Ø±Ù Ø§Ù„Ø¨ØµØ±ÙŠ (Ø¨Ø¯ÙˆÙ† Ø¨Ø§Ø±ÙƒÙˆØ¯)</h2>
    
    <div class="app-container">
        <div id="status-bar">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ "Ø§Ù„Ø¹Ù‚Ù„ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ" Ù„Ù…Ø³Ø­ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...</div>

        <div id="video-box">
            <video id="webcam" autoplay playsinline muted></video>
        </div>

        <div class="controls">
            <h4>1. ØªØ¹Ø±ÙŠÙ ØµÙ†Ù Ø¬Ø¯ÙŠØ¯</h4>
            <input type="text" id="item-name" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ (Ù…Ø«Ù„Ø§Ù‹: Ø²ÙŠØª Ø¹Ø§ÙÙŠØ©)">
            <button class="train-btn" onmousedown="train(true)" onmouseup="train(false)">Ø§Ø¶ØºØ· Ø¨Ø§Ø³ØªÙ…Ø±Ø§Ø± Ù„Ù„ØªØ¹Ø±ÙŠÙ (ØªØµÙˆÙŠØ±)</button>
            <p style="font-size: 11px; color: #94a3b8;">* Ø¶Ø¹ Ø§Ù„Ù…Ù†ØªØ¬ Ø£Ù…Ø§Ù… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆØ§Ø¶ØºØ· Ù„Ø«Ø§Ù†ÙŠØªÙŠÙ†</p>
            
            <hr style="border: 0.5px solid #334155;">
            
            <h4>2. Ø³Ø¬Ù„ Ø§Ù„Ø¬Ø±Ø¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</h4>
            <div id="inventory-table" class="inventory-list">
                <!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ -->
            </div>
        </div>
    </div>

    <script>
        const video = document.getElementById('webcam');
        const itemNameInput = document.getElementById('item-name');
        const statusBar = document.getElementById('status-bar');
        const inventoryTable = document.getElementById('inventory-table');
        
        let classifier;
        let net;
        let isTraining = false;
        let inventory = {}; // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ { "Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬": Ø§Ù„Ø¹Ø¯Ø¯ }

        async function init() {
            statusBar.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø³ÙŠØ±ÙØ±Ø§Øª Ø¬ÙˆØ¬Ù„ Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø±Ùƒ...";
            
            // ØªØ­Ù…ÙŠÙ„ Ù…ØµÙ†Ù KNN ÙˆÙ†Ù…ÙˆØ°Ø¬ MobileNet
            classifier = knnClassifier.create();
            net = await mobilenet.load();

            statusBar.innerText = "âœ… Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø²! Ù‚Ù… Ø¨ØªØ¹Ø±ÙŠÙ Ø£ÙˆÙ„ Ù…Ù†ØªØ¬ Ø§Ù„Ø¢Ù†";
            
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            video.srcObject = stream;
            
            animate();
        }

        // ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªØ¯Ø±ÙŠØ¨ (ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ø§Ù„ØµÙˆØ±)
        async function train(pressing) {
            isTraining = pressing;
            if (pressing && itemNameInput.value === "") {
                alert("ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ Ø£ÙˆÙ„Ø§Ù‹!");
                isTraining = false;
            }
        }

        async function animate() {
            if (net) {
                const img = tf.browser.fromPixels(video);
                const activation = net.infer(img, 'conv_preds');

                // Ø¥Ø°Ø§ ÙƒÙ†Ø§ Ù†Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ØªØ¹Ø±ÙŠÙØŒ Ù†Ø¶ÙŠÙ Ø§Ù„ØµÙˆØ± Ù„Ù„Ù…ØµÙ†Ù
                if (isTraining) {
                    classifier.addExample(activation, itemNameInput.value);
                    if (!inventory[itemNameInput.value]) {
                        inventory[itemNameInput.value] = 0;
                        updateTable();
                    }
                    statusBar.innerText = "Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø´ÙƒÙ„ Ø§Ù„Ù…Ù†ØªØ¬: " + itemNameInput.value;
                }

                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…ØµÙ†Ù ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ù†Ø¨Ø¯Ø£ Ø§Ù„ØªÙˆÙ‚Ø¹ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
                if (classifier.getNumClasses() > 0) {
                    const result = await classifier.predictClass(activation);
                    const { label, confidences } = result;

                    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ù…ØªØ£ÙƒØ¯Ø§Ù‹ Ø¨Ù†Ø³Ø¨Ø© Ø£ÙƒØ«Ø± Ù…Ù† 90%
                    if (confidences[label] > 0.95) {
                        handleAutoCount(label);
                    }
                }
                img.dispose();
            }
            requestAnimationFrame(animate);
        }

        let lastDetected = "";
        let lastTime = 0;

        function handleAutoCount(label) {
            const now = Date.now();
            // Ù…Ù†Ø¹ ØªÙƒØ±Ø§Ø± Ø§Ù„Ø¹Ø¯ Ù„Ù†ÙØ³ Ø§Ù„Ù…Ù†ØªØ¬ ÙÙŠ Ø£Ù‚Ù„ Ù…Ù† 3 Ø«ÙˆØ§Ù†Ù
            if (label !== lastDetected || now - lastTime > 3000) {
                inventory[label]++;
                lastDetected = label;
                lastTime = now;
                playBeep();
                updateTable();
                statusBar.innerText = "âœ… ØªÙ… Ø¬Ø±Ø¯: " + label;
            }
        }

        function updateTable() {
            inventoryTable.innerHTML = "";
            for (let name in inventory) {
                const row = document.createElement('div');
                row.className = 'item-row';
                row.innerHTML = `<span>${name}</span> <span>Ø§Ù„Ø¹Ø¯Ø¯: ${inventory[name]}</span>`;
                inventoryTable.appendChild(row);
            }
        }

        function playBeep() {
            const context = new AudioContext();
            const osc = context.createOscillator();
            osc.type = 'sine';
            osc.frequency.value = 1000;
            osc.connect(context.destination);
            osc.start();
            osc.stop(context.currentTime + 0.1);
        }

        init();
    </script>
</body>
</html>
