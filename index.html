<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø±Ø¯ Ø§Ù„Ø°ÙƒÙŠ 2025 - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</title>
    
    <!-- Ù‡Ø°Ù‡ Ù‡ÙŠ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ÙˆØ­ÙŠØ¯Ø© Ø§Ù„ØªÙŠ Ø³Ù†Ø³ØªØ®Ø¯Ù…Ù‡Ø§ØŒ ÙˆÙ‡ÙŠ Ù…Ø³ØªÙ‚Ø±Ø© Ø¬Ø¯Ø§Ù‹ -->
    <script src="cdn.jsdelivr.net"></script>
    <script src="cdn.jsdelivr.net"></script>

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #0f172a; color: #f8fafc; text-align: center; margin: 0; padding: 20px; }
        .app-card { max-width: 600px; margin: auto; background: #1e293b; padding: 20px; border-radius: 25px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); border: 1px solid #334155; }
        .video-container { position: relative; width: 100%; border-radius: 15px; overflow: hidden; background: #000; border: 2px solid #3b82f6; aspect-ratio: 4/3; }
        video, canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        #status-indicator { margin-top: 15px; padding: 10px; border-radius: 12px; background: #334155; color: #fbbf24; font-size: 14px; font-weight: bold; }
        .inventory-counter { font-size: 48px; font-weight: bold; color: #10b981; margin: 10px 0; }
        #log-area { margin-top: 15px; background: #020617; padding: 15px; border-radius: 12px; height: 120px; overflow-y: auto; text-align: right; font-size: 13px; border: 1px solid #1e293b; }
        .success-text { color: #10b981; }
    </style>
</head>
<body>

    <div class="app-card">
        <h2 style="color: #3b82f6; margin-bottom: 5px;">ğŸ›’ Ù†Ø¸Ø§Ù… Ø¬Ø±Ø¯ Ø§Ù„Ù…Ø­Ù„ Ø§Ù„Ø°ÙƒÙŠ</h2>
        <p style="color: #94a3b8; font-size: 12px; margin-bottom: 15px;">Ø¥ØµØ¯Ø§Ø± 2025 - Ø±ØµØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</p>

        <div class="video-container">
            <video id="webcam" autoplay playsinline muted></video>
            <canvas id="overlay"></canvas>
        </div>

        <div id="status-indicator">Ø¬Ø§Ø±ÙŠ Ø¥ÙŠÙ‚Ø§Ø¸ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ...</div>
        
        <div class="inventory-counter" id="total-items">0</div>
        <div style="color: #94a3b8; font-size: 12px;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ù…ÙƒØªØ´ÙØ©</div>

        <div id="log-area">
            <div style="color: #64748b;">Ø§Ù†ØªØ¸Ø§Ø± Ø±ØµØ¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...</div>
        </div>
        
        <button onclick="location.reload()" style="margin-top: 15px; background: none; border: 1px solid #475569; color: #94a3b8; padding: 5px 15px; border-radius: 5px; cursor: pointer;">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø¸Ø§Ù…</button>
    </div>

    <script>
        const video = document.getElementById('webcam');
        const canvas = document.getElementById('overlay');
        const ctx = canvas.getContext('2d');
        const status = document.getElementById('status-indicator');
        const counterDisplay = document.getElementById('total-items');
        const logArea = document.getElementById('log-area');
        
        let model;
        let itemCount = 0;
        let lastDetectedTime = 0;

        // 1. ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                video.srcObject = stream;
                status.innerText = "Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...";
                loadModel();
            } catch (err) {
                status.innerText = "âŒ ÙØ´Ù„ ÙØªØ­ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§. ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø·Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©.";
                status.style.color = "#f43f5e";
            }
        }

        // 2. ØªØ­Ù…ÙŠÙ„ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
        async function loadModel() {
            try {
                model = await cocoSsd.load();
                status.innerText = "âœ… Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø²! ÙˆØ¬Ù‡ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª";
                status.style.color = "#10b981";
                detectFrame();
            } catch (err) {
                status.innerText = "âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø±Ùƒ. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ø¯ÙŠØ«.";
                console.error(err);
            }
        }

        // 3. Ø§Ù„Ø±ØµØ¯ Ø§Ù„Ù„Ø­Ø¸ÙŠ
        async function detectFrame() {
            const predictions = await model.detect(video);
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            predictions.forEach(prediction => {
                // Ø±Ø³Ù… Ø§Ù„Ù…Ø±Ø¨Ø¹
                ctx.strokeStyle = "#10b981";
                ctx.lineWidth = 4;
                ctx.strokeRect(...prediction.bbox);

                // ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø§Ø³Ù…
                ctx.fillStyle = "#10b981";
                ctx.font = "bold 18px Arial";
                ctx.fillText(prediction.class, prediction.bbox[0], prediction.bbox[1] > 20 ? prediction.bbox[1] - 10 : 20);

                // Ø¢Ù„ÙŠØ© Ø§Ù„Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ: Ù†Ø²ÙŠØ¯ Ø§Ù„Ø¹Ø¯Ø¯ Ø¥Ø°Ø§ Ø±ØµØ¯Ù†Ø§ Ø´ÙŠØ¦Ø§Ù‹ Ø¬Ø¯ÙŠØ¯Ø§Ù‹ (ÙƒÙ„ Ø«Ø§Ù†ÙŠØªÙŠÙ† Ù…Ø«Ù„Ø§Ù‹ Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±)
                if (Date.now() - lastDetectedTime > 2000) {
                    itemCount++;
                    counterDisplay.innerText = itemCount;
                    lastDetectedTime = Date.now();
                    
                    const entry = document.createElement('div');
                    entry.className = "success-text";
                    entry.innerText = `[${new Date().toLocaleTimeString()}] ØªÙ… Ø¬Ø±Ø¯: ${prediction.class}`;
                    logArea.prepend(entry);
                    
                    // Ø¥ØµØ¯Ø§Ø± ØµÙˆØª ØªÙ†Ø¨ÙŠÙ‡
                    playBeep();
                }
            });

            requestAnimationFrame(detectFrame);
        }

        function playBeep() {
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = audioCtx.createOscillator();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(880, audioCtx.currentTime);
            osc.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.1);
        }

        window.onload = startCamera;
    </script>
</body>
</html>
