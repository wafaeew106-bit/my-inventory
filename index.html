<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø±Ø¯ Ø§Ù„Ø°ÙƒÙŠ - Ù†Ø³Ø®Ø© Ø§Ù„Ù„Ø§Ø¨ØªÙˆØ¨ 2025</title>
    
    <!-- ØªÙ… ØªØºÙŠÙŠØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ÙƒØªØ§Ø¨Ø© Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø­Ø¯ÙˆØ« Ø®Ø·Ø£ 404 -->
    <script src="cdnjs.cloudflare.com" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="unpkg.com" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <style>
        body { font-family: sans-serif; background: #0f172a; color: white; text-align: center; margin: 0; padding: 20px; }
        .camera-container { position: relative; display: inline-block; border: 5px solid #3b82f6; border-radius: 20px; overflow: hidden; background: #000; }
        #status { margin-top: 15px; padding: 10px; background: #1e293b; border-radius: 10px; color: #fbbf24; font-weight: bold; }
        .log-box { margin-top: 20px; background: #000; color: #10b981; padding: 15px; border-radius: 10px; height: 120px; overflow-y: auto; text-align: right; border: 1px solid #334155; }
    </style>
</head>
<body>

    <h2>ğŸ›’ Ø¬Ø±Ø¯ Ø§Ù„Ù…Ø­Ù„ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ (Ù„Ø§Ø¨ØªÙˆØ¨)</h2>
    
    <div class="camera-container" id="video-box">
        <!-- Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
    </div>

    <div id="status">Ø¬Ø§Ø±ÙŠ ØªØ­Ø¶ÙŠØ± "Ù…Ø®" Ø§Ù„Ù†Ø¸Ø§Ù…... Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹</div>

    <div class="log-box" id="log">
        <b>Ø³Ø¬Ù„ Ø§Ù„Ø¬Ø±Ø¯ Ø§Ù„Ù„Ø­Ø¸ÙŠ:</b><br>
    </div>

    <script>
        let video;
        let detector;
        let detections = [];

        // Ø¯Ø§Ù„Ø© Setup Ù…Ù† Ù…ÙƒØªØ¨Ø© p5.js
        function setup() {
            // Ø¥Ù†Ø´Ø§Ø¡ Ù„ÙˆØ­Ø© Ø§Ù„Ø±Ø³Ù…
            const canvas = createCanvas(480, 360);
            canvas.parent('video-box');

            // ÙØªØ­ ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„ÙˆÙŠØ¨ Ù„Ù„Ø§Ø¨ØªÙˆØ¨ Ø¨Ø´ÙƒÙ„ Ù…Ø¨Ø§Ø´Ø±
            video = createCapture(VIDEO, function(stream) {
                console.log("Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙØªØ­Øª Ø¨Ù†Ø¬Ø§Ø­");
                document.getElementById('status').innerText = "âœ… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ØªØ¹Ù…Ù„.. Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ...";
            });
            video.size(480, 360);
            video.hide();

            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ COCO-SSD Ù„Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø´ÙŠØ§Ø¡
            detector = ml5.objectDetector('cocossd', modelReady);
        }

        function modelReady() {
            document.getElementById('status').innerText = "âœ… Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø²! ÙˆØ¬Ù‡ Ø§Ù„Ø²Ø¬Ø§Ø¬Ø© Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§";
            document.getElementById('status').style.color = "#4caf50";
            // Ø§Ù„Ø¨Ø¯Ø¡ ÙÙŠ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø±ØµØ¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
            detect();
        }

        function detect() {
            detector.detect(video, (err, results) => {
                if (err) return;
                detections = results;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¬Ù„ Ø¥Ø°Ø§ ØªÙ… Ø±ØµØ¯ Ø²Ø¬Ø§Ø¬Ø© Ø£Ùˆ ØºÙŠØ±Ù‡Ø§
                if (detections.length > 0) {
                    addToLog(detections[0].label);
                }
                
                detect(); // Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø§Ù„Ø±ØµØ¯
            });
        }

        function addToLog(label) {
            const log = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            let name = label === 'bottle' ? "Ø²Ø¬Ø§Ø¬Ø© Ù…ÙŠØ§Ù‡" : label;
            
            // ØªØ¬Ù†Ø¨ Ø§Ù„ØªÙƒØ±Ø§Ø± Ø§Ù„Ù…Ù…Ù„ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„
            if (!log.innerHTML.includes(name + " " + time.slice(0, -2))) {
                log.innerHTML = `<div>[${time}] ØªÙ… Ø±ØµØ¯: ${name}</div>` + log.innerHTML;
            }
        }

        function draw() {
            // Ø±Ø³Ù… Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
            image(video, 0, 0, width, height);

            // Ø±Ø³Ù… Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª Ø­ÙˆÙ„ Ø§Ù„Ø£Ø´ÙŠØ§Ø¡
            for (let i = 0; i < detections.length; i++) {
                let obj = detections[i];
                stroke(0, 255, 0);
                strokeWeight(4);
                noFill();
                rect(obj.x, obj.y, obj.width, obj.height);
                
                noStroke();
                fill(0, 255, 0);
                textSize(18);
                text(obj.label, obj.x + 5, obj.y + 20);
            }
        }
    </script>
</body>
</html>
